- name: Execute Core-file Status Check Command
  shell: kubectl exec {{ pod_name }} -n {{ namespace }} -- find /data/storage/corefiles/ /data/storage/vmcores/ /var/log/vcm/crashes/ /var/crash/ -maxdepth 1 -type f -mmin -{{ corefile_threshold_min }} -exec ls -lrth {} \;
  register: cmdOutput
  ignore_errors: yes

- name: Display command output
  debug:
    msg: "Command output: {{ cmdOutput.stdout | default('No output in check mode') }}"

- name: Check if any core files found
  set_fact:
    core_files_found: "{{ cmdOutput.stdout_lines | default([]) | length > 0 }}"

- name: Determine final result
  set_fact:
    final_result: "{{ 'FAIL' if core_files_found else 'PASS' }}"

- name: Result
  debug:
    msg: "{{ final_result }} - Core files check: {{ 'Found core files' if core_files_found else 'No core files found' }}"

- name: Set final result for EID_006
  set_fact:
    eid_006_final_result: "{{ final_result }}"
