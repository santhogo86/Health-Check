- name: Execute Peer IP / VNF Check Command
  shell: kubectl exec {{ pod_name }} -n {{ namespace }} -- {{ EID_007_CMD }}
  register: cmdOutput
  ignore_errors: yes

- name: Display command output
  debug:
    msg: "Command output: {{ cmdOutput.stdout | default('No output in check mode') }}"

- name: Parse peer VNF output
  set_fact:
    peer_vnf_output: "{{ cmdOutput.stdout | default('') }}"

- name: Check for peer VNF table data
  set_fact:
    peer_vnf_found: "{{ 'peer_vnf' in peer_vnf_output and peer_vnf_output | length > 100 }}"

- name: Check for peer IP table data
  set_fact:
    peer_ip_found: "{{ 'peer_ip' in peer_vnf_output and peer_vnf_output | length > 100 }}"

- name: Check for VNF ID presence
  set_fact:
    vnf_ids_present: "{{ peer_vnf_output | regex_findall('\\d+') | length > 0 }}"

- name: Determine final result
  set_fact:
    final_result: "{{ 'PASS' if (peer_vnf_found and peer_ip_found and vnf_ids_present) else 'FAIL' }}"

- name: Result
  debug:
    msg: "{{ final_result }} - Peer VNF/IP check: VNF={{ peer_vnf_found }}, IP={{ peer_ip_found }}, IDs={{ vnf_ids_present }}"

- name: Set final result for EID_007
  set_fact:
    eid_007_final_result: "{{ final_result }}"
