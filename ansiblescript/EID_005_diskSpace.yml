- name: Execute Disk Space Status Check Command
  shell: kubectl exec {{ pod_name }} -n {{ namespace }} -- {{ EID_005_CMD }}
  register: cmdOutput
  ignore_errors: yes

- name: Display command output
  debug:
    msg: "Command output: {{ cmdOutput.stdout | default('No output in check mode') }}"

- name: Parse disk space output
  set_fact:
    disk_info: "{{ cmdOutput.stdout_lines | default([]) | select('match', '^/.*') | list }}"

- name: Check disk space thresholds
  set_fact:
    disk_failures: "{{ disk_failures | default([]) + [item] }}"
  vars:
    usage_percent: "{{ (item.split()[4] | regex_replace('%', '')) | int }}"
  with_items: "{{ disk_info }}"
  when: 
    - disk_info | length > 0
    - (item.split()[4] | regex_replace('%', '')) | int > volume_size_threshold

- name: Determine final result
  set_fact:
    final_result: "{{ 'PASS' if (disk_failures | default([]) | length == 0) else 'FAIL' }}"

- name: Result
  debug:
    msg: "{{ final_result }} - Disk space check completed"

- name: Set final result for EID_005
  set_fact:
    eid_005_final_result: "{{ final_result }}"
