- name: Execute VNF Active Alarm Check Command
  shell: kubectl exec {{ pod_name }} -n {{ namespace }} -- {{ EID_008_CMD }}
  register: cmdOutput
  ignore_errors: yes

- name: Display command output
  debug:
    msg: "Command output: {{ cmdOutput.stdout | default('No output in check mode') }}"

- name: Parse active alarms output
  set_fact:
    active_alarms_output: "{{ cmdOutput.stdout | default('') }}"

- name: Check for critical alarms
  set_fact:
    critical_alarms_found: "{{ 'critical' in active_alarms_output.lower() or 'major' in active_alarms_output.lower() }}"

- name: Check for any severity alarms
  set_fact:
    severity_alarms_count: "{{ active_alarms_output | regex_findall('severity') | length }}"

- name: Check if alarms output is empty or contains no alarms
  set_fact:
    no_alarms_found: "{{ active_alarms_output | length < 50 or 'no alarms' in active_alarms_output.lower() or severity_alarms_count == 0 }}"

- name: Determine final result
  set_fact:
    final_result: "{{ 'PASS' if no_alarms_found else 'FAIL' }}"

- name: Result
  debug:
    msg: "{{ final_result }} - Active alarms check: {{ 'No active alarms' if no_alarms_found else 'Active alarms found' }}"

- name: Set final result for EID_008
  set_fact:
    eid_008_final_result: "{{ final_result }}"
